# Comprehensive Form Testing Plan - Alleato-Procore

## Overview
This document outlines a step-by-step testing plan for all forms in the Alleato-Procore application. Each test will be executed using Playwright, with screenshots captured as evidence of successful completion.

## Test Prerequisites
- [ ] Local development environment running (`npm run dev`)
- [ ] Supabase instance accessible
- [ ] Test user account created
- [ ] Playwright installed and configured

## Testing Methodology
1. Navigate to each form
2. Fill out all required and optional fields
3. Submit the form
4. Verify successful submission
5. Check data in Supabase
6. Verify data displays on relevant pages
7. Capture screenshots at each step

---

## 1. Authentication Forms

### 1.1 Sign Up Form
**URL**: `/auth/sign-up`
- [ ] Navigate to sign up page
- [ ] Fill in email: `test-user-{timestamp}@example.com`
- [ ] Fill in password: `TestPassword123!`
- [ ] Submit form
- [ ] Verify success message
- [ ] Check user created in Supabase Auth
- [ ] Screenshot: [Sign up success]()

### 1.2 Login Form
**URL**: `/auth/login`
- [ ] Navigate to login page
- [ ] Enter email from sign up
- [ ] Enter password
- [ ] Submit form
- [ ] Verify redirect to dashboard
- [ ] Screenshot: [Login success]()

### 1.3 Forgot Password Form
**URL**: `/auth/forgot-password`
- [ ] Navigate to forgot password page
- [ ] Enter registered email
- [ ] Submit form
- [ ] Verify success message
- [ ] Check email logs in Supabase
- [ ] Screenshot: [Password reset sent]()

### 1.4 Update Password Form
**URL**: `/auth/update-password`
- [ ] Navigate to update password (when logged in)
- [ ] Enter current password
- [ ] Enter new password
- [ ] Confirm new password
- [ ] Submit form
- [ ] Verify success message
- [ ] Test login with new password
- [ ] Screenshot: [Password updated]()

---

## 2. Project Management

### 2.1 Create New Project
**URL**: `/project-form`
- [ ] Navigate to project creation form
- [ ] Fill basic information:
  - [ ] Project Name: `Test Project ${timestamp}`
  - [ ] Description: `Comprehensive test project for form validation`
  - [ ] Project Number: `TEST-001`
  - [ ] Address: `123 Test Street, Test City, TC 12345`
- [ ] Fill project details:
  - [ ] Stage: `Pre-Construction`
  - [ ] Work Scope: `New Construction`
  - [ ] Sector: `Commercial`
  - [ ] Delivery Method: `Design-Build`
  - [ ] Type: `Office Building`
- [ ] Set dates:
  - [ ] Start Date: Current date
  - [ ] End Date: 6 months from now
  - [ ] Substantial Completion: 5 months from now
- [ ] Configure settings:
  - [ ] Timezone: `America/New_York`
  - [ ] Country: `United States`
  - [ ] State: `New York`
  - [ ] Privacy: `Private`
- [ ] Submit form
- [ ] Verify redirect to project page
- [ ] Check project in Supabase `projects` table
- [ ] Screenshot: [Project created]()
- [ ] Screenshot: [Project in database]()
- [ ] Screenshot: [Project home page]()

---

## 3. Budget Management

### 3.1 Create Budget Line Items (Form Page)
**URL**: `/{projectId}/budget/line-item/new`
- [ ] Navigate to budget line item creation page
- [ ] Add first line item:
  - [ ] Select/Create Budget Code: `01-3120.L`
  - [ ] Quantity: `100`
  - [ ] UOM: `HR`
  - [ ] Unit Cost: `75.00`
  - [ ] Verify Amount: `7,500.00`
- [ ] Add second line item:
  - [ ] Budget Code: `03-1000.M`
  - [ ] Quantity: `50`
  - [ ] UOM: `CY`
  - [ ] Unit Cost: `120.00`
  - [ ] Verify Amount: `6,000.00`
- [ ] Submit form
- [ ] Verify success message
- [ ] Check `budget_items` table in Supabase
- [ ] Navigate to budget page
- [ ] Verify line items display correctly
- [ ] Screenshot: [Budget form filled]()
- [ ] Screenshot: [Budget items in database]()
- [ ] Screenshot: [Budget page with items]()

### 3.2 Create Budget Line Items (Modal)
**URL**: `/{projectId}/budget` (click "Create Budget Line Item" button)
- [ ] Open budget line item modal
- [ ] Add line item via modal:
  - [ ] Budget Code: `02-4100.E`
  - [ ] Quantity: `1`
  - [ ] UOM: `LS`
  - [ ] Unit Cost: `5000.00`
- [ ] Submit modal form
- [ ] Verify item added to budget
- [ ] Screenshot: [Modal form]()
- [ ] Screenshot: [Updated budget]()

### 3.3 Budget Modifications
**URL**: `/{projectId}/budget` (click modify on existing item)
- [ ] Click modify on budget item
- [ ] Enter modification amount: `1,000.00`
- [ ] Enter reason: `Additional materials required`
- [ ] Submit modification
- [ ] Verify revised budget updated
- [ ] Check budget modifications in database
- [ ] Screenshot: [Modification form]()
- [ ] Screenshot: [Modified budget]()

---

## 4. Financial Forms

### 4.1 Create Subcontract Commitment
**URL**: `/{projectId}/commitments/new?type=subcontract`
- [ ] Navigate to commitments form
- [ ] Fill commitment details:
  - [ ] Number: `SC-001`
  - [ ] Title: `Electrical Subcontract`
  - [ ] Description: `Complete electrical installation for project`
  - [ ] Status: `Draft`
  - [ ] Contract Company: Select or create company
  - [ ] Contract Amount: `150,000.00`
  - [ ] Executed Date: Current date
  - [ ] Start Date: Next week
  - [ ] Completion Date: 3 months from now
  - [ ] Retention: `10%`
  - [ ] Accounting Method: `Percent Complete`
  - [ ] Assignee: Select user
  - [ ] Private: No
- [ ] Submit form
- [ ] Verify success and redirect
- [ ] Check `commitments` table in Supabase
- [ ] Navigate to commitments page
- [ ] Verify commitment displays
- [ ] Screenshot: [Subcontract form]()
- [ ] Screenshot: [Commitment in database]()
- [ ] Screenshot: [Commitments list]()

### 4.2 Create Purchase Order Commitment
**URL**: `/{projectId}/commitments/new?type=purchase_order`
- [ ] Navigate to purchase order form
- [ ] Fill purchase order details:
  - [ ] Number: `PO-001`
  - [ ] Title: `Steel Materials Order`
  - [ ] Description: `Structural steel for main building`
  - [ ] Status: `Approved`
  - [ ] Contract Company: Select vendor
  - [ ] Contract Amount: `75,000.00`
  - [ ] Executed Date: Current date
  - [ ] Delivery Date: 2 weeks from now
- [ ] Submit form
- [ ] Verify in commitments list
- [ ] Screenshot: [PO form]()
- [ ] Screenshot: [PO in list]()

### 4.3 Create Prime Contract (If Implemented)
**URL**: `/{projectId}/contracts/new`
- [ ] Check if form is implemented
- [ ] If yes, fill contract details
- [ ] Submit and verify
- [ ] Screenshot: [Contract form]()

### 4.4 Create Change Order (If Implemented)
**URL**: `/{projectId}/change-orders/new`
- [ ] Check if form is implemented
- [ ] If yes, fill change order details
- [ ] Submit and verify
- [ ] Screenshot: [Change order form]()

### 4.5 Create Invoice (If Implemented)
**URL**: `/{projectId}/invoices/new`
- [ ] Check if form is implemented
- [ ] If yes, fill invoice details
- [ ] Submit and verify
- [ ] Screenshot: [Invoice form]()

---

## 5. Data Verification

### 5.1 Project Home Page
**URL**: `/{projectId}/home`
- [ ] Navigate to project home
- [ ] Verify project details display
- [ ] Check financial toggles show:
  - [ ] Budget summary with totals
  - [ ] Prime contract info
  - [ ] Commitments summary
- [ ] Verify recent activities
- [ ] Screenshot: [Project home overview]()
- [ ] Screenshot: [Financial toggles expanded]()

### 5.2 Budget Page
**URL**: `/{projectId}/budget`
- [ ] Navigate to budget page
- [ ] Verify all budget line items display
- [ ] Check totals calculation
- [ ] Verify modifications reflected
- [ ] Test filtering and sorting
- [ ] Screenshot: [Complete budget view]()

### 5.3 Commitments Page
**URL**: `/{projectId}/commitments`
- [ ] Navigate to commitments page
- [ ] Verify all commitments display
- [ ] Check subcontracts tab
- [ ] Check purchase orders tab
- [ ] Verify totals and summaries
- [ ] Screenshot: [Commitments overview]()

### 5.4 Contracts Page
**URL**: `/{projectId}/contracts`
- [ ] Navigate to contracts page
- [ ] Verify any contracts display
- [ ] Screenshot: [Contracts page]()

### 5.5 Change Orders Page
**URL**: `/{projectId}/change-orders`
- [ ] Navigate to change orders page
- [ ] Verify any change orders display
- [ ] Screenshot: [Change orders page]()

### 5.6 Invoices Page
**URL**: `/{projectId}/invoices`
- [ ] Navigate to invoices page
- [ ] Verify any invoices display
- [ ] Screenshot: [Invoices page]()

---

## 6. Database Verification

### 6.1 Supabase Tables Check
- [ ] Projects table: Verify project created with all fields
- [ ] Budget_items table: Verify all budget items with correct data
- [ ] Commitments table: Verify commitments with relationships
- [ ] Check all foreign key relationships intact
- [ ] Verify RLS policies working (data isolation)
- [ ] Screenshot: [Database tables overview]()

---

## 7. Error Handling Tests

### 7.1 Form Validation
- [ ] Test required field validation
- [ ] Test invalid email formats
- [ ] Test number field constraints
- [ ] Test date validation
- [ ] Verify error messages display
- [ ] Screenshot: [Validation errors]()

### 7.2 API Error Handling
- [ ] Test with network disconnected
- [ ] Test with invalid data
- [ ] Verify error toasts display
- [ ] Check form remains fillable after error
- [ ] Screenshot: [Error handling]()

---

## Test Execution Summary

| Form | Status | Screenshot Link | Notes |
|------|--------|-----------------|-------|
| Sign Up | ✅ Form Exists | [View](frontend/tests/screenshots/form-tests/signup.png) | All fields present: email, password, name |
| Login | ✅ Form Exists | [View](frontend/tests/screenshots/form-tests/login.png) | Email & password fields functional |
| Forgot Password | ✅ Form Exists | [View](frontend/tests/screenshots/form-tests/forgot-password.png) | Email field for reset |
| Update Password | ⚠️ Requires Auth | | Need to be logged in to access |
| Create Project | ✅ Form Exists | [View](frontend/tests/screenshots/form-tests/project-form.png) | Comprehensive form with all fields |
| Budget Line Items (Form) | ❌ Error Fixed | | Fixed calculation_method constraint error |
| Budget Line Items (Modal) | ✅ Component Ready | | Modal component implemented |
| Budget Modifications | ⚠️ Partial | | Modal exists but needs testing |
| Create Subcontract | ✅ Form Exists | [View](frontend/tests/screenshots/form-tests/commitments-subcontract.png) | Full form implemented |
| Create Purchase Order | ✅ Form Exists | [View](frontend/tests/screenshots/form-tests/commitments-po.png) | Full form implemented |
| Create Contract | ❌ Not Implemented | | Placeholder page only |
| Create Change Order | ❌ Not Implemented | | Placeholder page only |
| Create Invoice | ❌ Not Implemented | | Placeholder page only |

---

## Automated Test Script

The Playwright test script for executing all these tests is located at:
`/frontend/tests/e2e/comprehensive-form-testing.spec.ts`

To run all tests:
```bash
npm run test:forms
```

To run with UI mode for debugging:
```bash
npm run test:forms:ui
```

---

## Notes
- All timestamps use format: `YYYYMMDD-HHMMSS`
- Screenshots are saved to: `/frontend/tests/screenshots/form-tests/`
- Test data is prefixed with "TEST-" for easy identification
- Each test run creates unique data to avoid conflicts

Last Updated: 2025-12-15
Test Environment: Local Development
Tester: AI Assistant

## Current Implementation Status

### ✅ Fully Implemented Forms
1. **Authentication** - All auth forms (login, signup, password reset) are complete
2. **Project Creation** - Full project form with all fields
3. **Commitments** - Both subcontract and purchase order forms
4. **Budget Line Items** - Form and modal versions (with recent bug fix)

### ⚠️ Partially Implemented
1. **Budget Modifications** - Modal exists but needs full testing
2. **Legacy Forms** - Exist in /forms directory but may need migration

### ❌ Not Yet Implemented
1. **Contracts** - Only placeholder page exists
2. **Change Orders** - Only placeholder page exists  
3. **Invoices** - Only placeholder page exists

## Key Findings

1. **Budget Line Item Error Fixed**: The `calculation_method` constraint error was fixed by:
   - Correcting the enum value from 'unit' to 'unit_price'
   - Removing non-existent columns from insert
   - Adding proper cost code UUID lookup

2. **Routing Structure**: New project-scoped routing uses `/{projectId}/` prefix for all project-specific pages

3. **Form Validation**: All forms use Zod schemas for validation

4. **Authentication Required**: Most forms require authentication to access

## Running the Tests

To execute the comprehensive test suite:

1. **Start the dev server**:
   ```bash
   cd frontend
   npm run dev
   ```

2. **Run form tests**:
   ```bash
   npm run test:forms         # Run all tests
   npm run test:forms:ui      # Run with UI mode
   npm run test:forms:headed  # Run in headed browser
   ```

3. **Capture screenshots**:
   ```bash
   node scripts/capture-forms.mjs
   ```

## Next Steps

1. **Complete Testing** - Run full test suite with dev server running
2. **Implement Missing Forms** - Contracts, Change Orders, Invoices
3. **Database Verification** - Check all data properly saved to Supabase
4. **Integration Testing** - Verify data flows between all pages