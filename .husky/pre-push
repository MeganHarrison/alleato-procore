#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

# Run full typecheck on entire project
echo "ğŸ“ Type checking entire project..."
npm run typecheck --prefix frontend
TYPECHECK_EXIT=$?

# Run full lint on entire project
echo ""
echo "ğŸ” Linting entire project..."
npm run lint --prefix frontend
LINT_EXIT=$?

# Run unit tests to keep service layer coverage healthy
echo ""
echo "ğŸ§ª Running unit tests..."
npm run test:unit --prefix frontend
TEST_EXIT=$?

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# Block push if either check failed
if [ $TYPECHECK_EXIT -ne 0 ] || [ $LINT_EXIT -ne 0 ] || [ $TEST_EXIT -ne 0 ]; then
  echo "âŒ Pre-push checks FAILED"
  echo ""
  echo "PUSH BLOCKED - Fix all errors before pushing"
  echo ""
  echo "Run these commands to see errors:"
  echo "  npm run typecheck --prefix frontend"
  echo "  npm run lint --prefix frontend"
  echo "  npm run test:unit --prefix frontend"
  echo ""
  exit 1
fi

echo "âœ… Pre-push checks PASSED - Push allowed"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
