# Prime Contracts Page Components + Functionality

**File Path** - /frontend/src/app/[projectId]/contracts/page.tsx

![Prime Contracts](./pages/562949958876859_dropdown_1/prime-contract-screenshot.png)

**Procore Links**

- [Prime Contracts](https://us02.procore.com/webclients/host/companies/562949953443325/projects/562949955214786/tools/contracts/prime_contracts)

- [Prime Contaract Page](https://us02.procore.com/webclients/host/companies/562949953443325/projects/562949955214786/tools/contracts/prime_contracts/562949958876859)

- [New Prime Contract Change Order](https://us02.procore.com/562949955214786/project/prime_contracts/562949958876859/change_orders/change_order_packages/new)

- [Create New Change Event](https://us02.procore.com/562949955214786/project/change_events/events/new)

## Page Header

### Actions

1. **Export button:** Export contracts data (typically CSV/PDF options in Procore patterns)
2. **Create button:** Opens Prime Contract create flow
3. **Configure Settings icon:** Opens Prime Contract settings/configure tab

## Filtering + Search Controls

### A) Filter Drawer / Filter Bar

1. Filters panel open/close
2. Clear All Filters
3. Filter fields present:

- **Owner/Client** (input/select)
- **ERP Status** (input/select)
- **Status** (input/select)
- **Executed** (input/select)

### B) Quick Search

- **Inline search input** (type-to-filter)

### C) Grouping

- **“Select a column to group”** control. Drag/drop or choose grouping behavior (grid supports row groups)

### D) Column Configuration

- **Configure button** (grid column chooser / layout settings)

## Main Grid: Prime Contracts List (AG Grid–style)

### Grid Mechanics

- **Loading state** (“Loading”)
- **Row selection**

  - Header checkbox: select all rows
  - Row checkbox: select individual row
- **Column headers with “More Options”**

  - Each column has a kebab/options control (sort, filter, pin, autosize, hide, etc. typical grid behavior)

### Columns Visible

| Title                         | Description                                   | Formula / Value                                | Data Type        | Source / Dependency                     | UX / Notes                          |
| ----------------------------- | --------------------------------------------- | ---------------------------------------------- | ---------------- | --------------------------------------- | ----------------------------------- |
| Number                        | Unique identifier for the prime contract      | User-defined or auto-generated contract number | String           | `prime_contracts.number`                | Clickable → opens contract detail   |
| Owner / Client                | Entity that owns the contract (client)        | Selected organization / company                | Entity reference | `companies` / `clients` table           | Filterable                          |
| Title                         | Descriptive name of the prime contract        | Free-text title                                | String           | `prime_contracts.title`                 | Used heavily for search             |
| Status                        | Contract lifecycle state                      | Enum (Draft, Approved, Executed, etc.)         | Enum             | `prime_contracts.status`                | Controls editability                |
| Executed                      | Indicates if contract has been fully executed | Yes / No                                       | Boolean          | `prime_contracts.executed_at != null`   | Often gated by signatures           |
| Original Contract Amount      | Initial contract value before changes         | Base contract amount                           | Currency         | `prime_contracts.original_amount`       | Baseline for all calculations       |
| Approved Change Orders        | Sum of all **approved** change orders         | `SUM(approved CO amounts)`                     | Currency         | `change_orders WHERE status = approved` | Impacts revised contract            |
| Revised Contract Amount       | Total contract value including approved COs   | `Original + Approved COs`                      | Currency         | Derived                                 | **Key financial truth source**      |
| Pending Change Orders         | Sum of submitted but unapproved COs           | `SUM(pending CO amounts)`                      | Currency         | `change_orders WHERE status = pending`  | Forecast-only                       |
| Draft Change Orders           | Sum of draft COs                              | `SUM(draft CO amounts)`                        | Currency         | `change_orders WHERE status = draft`    | Internal planning only              |
| Invoiced                      | Total amount invoiced to date                 | `SUM(invoice line items)`                      | Currency         | `invoices`                              | Must reconcile with billing periods |
| Payments Received             | Total payments collected                      | `SUM(payments)`                                | Currency         | `payments`                              | Used for % Paid                     |
| % Paid                        | Portion of revised contract paid              | `Payments Received ÷ Revised Contract`         | Percentage       | Derived                                 | Should guard divide-by-zero         |
| Remaining Balance Outstanding | Amount still owed                             | `Revised Contract − Payments Received`         | Currency         | Derived                                 | Critical AR metric                  |
| Private                       | Visibility flag                               | Yes / No                                       | Boolean          | `prime_contracts.is_private`            | Controls permissions                |
| Attachments                   | Count of attached files                       | `COUNT(files)`                                 | Integer          | `attachments`                           | Opens attachment drawer             |

### Grid-Level / Structural Behaviors (Important)

| Feature | Behavior |
| ------- | ------- |
| Sorting | Per-column, ASC/DESC toggle |
| Filtering | Column-level + global filter |
| Grouping | Drag column to group |
| Totals Row | Aggregates numeric columns |
| Row Selection Checkbox | (single / bulk actions) |
| Column State | Width, pinning, order customizable |
| Export | CSV / PDF via grid state |

### Financial Integrity Rules (Non-Negotiable)

These should be enforced in code + tests:

- Revised Contract Amount = Original + Approved COs
- Remaining Balance = Revised − Payments Received
  - % Paid = Payments Received ÷ Revised
- Pending/Draft COs never affect Revised
- Executed contracts should be locked from base amount edits

### Playwright Assertions (High Value)

At minimum, you should test:

Revised amount recalculates after approving a CO

% Paid updates after recording a payment

### Row Interactions / Actions

For the visible contract row:

- **Contract number link**

  - Opens Prime Contract detail page
- **PDF / attachment button**

  - Opens contract PDF
- **Edit button**

  - Opens edit page for that contract

## Inline Detail: Change Orders Grid (Expandable/Related List)

This page is also showing the related **Change Orders** section beneath the contract list.

### A) Change Orders Table Mechanics

- Row selection checkboxes
- Column header “More Options” per column

### B) Columns Visible (Change Orders)

- Potential Change Order (link/title)
- PCCO (package link like “CO #005”)
- Status
- Executed
- Approved Change Orders (amount)
- Pending Change Orders (amount)
- Draft Change Orders (amount)

### C) Row Interactions

- **Potential Change Order title link**

  - Opens the specific Potential Change Order detail
- **PCCO / Change Order Package link**

  - Opens the package (CO #001, #002, etc.)

## Totals / Aggregations

- **Grand Totals row** at bottom of the Prime Contracts grid showing totals for:

  - Original Contract Amount
  - Approved Change Orders
  - Revised Contract Amount
  - Pending Change Orders
  - Draft Change Orders
  - Invoiced
  - Payments Received
  - % Paid
  - Remaining Balance Outstanding

## Pagination

- Pagination control present (“…of Page of…”)
