# Component System - Phase 0 UI Foundation

**Purpose**: This document defines the complete UI component library that powers all pages in Alleato OS. Phase 0 components provide consistent, reusable primitives for layout, tables, forms, and UI elements.

**Status**: Core system complete - ongoing refinement and additions

**Related Plans**:
- [PLANS_DOC.md](./PLANS_DOC.md) - Master plan index
- [UI Consistency](./plans-ui-consistency.md) - Refactoring pages to use these components
- [Testing Strategy](./plans-testing-strategy.md) - Component testing requirements

---

## Overview

Phase 0 establishes the foundational component system that ALL pages must use. This ensures:
- **Self-consistency**: Every page looks and behaves the same way
- **Maintainability**: Changes propagate automatically across all pages
- **Rapid development**: New pages compose from existing building blocks
- **Quality**: Components are tested once, work everywhere

### Design Philosophy

1. **Composition over configuration**: Components combine to create complex UIs
2. **Sensible defaults**: Works out-of-the-box with minimal props
3. **Escape hatches**: Advanced use cases supported via props
4. **Accessibility first**: ARIA labels, keyboard navigation, screen reader support
5. **TypeScript strict**: Full type safety with generated Supabase types

---

## Implementation Progress

### Phase 0 Completion Timeline

**2025-12-09**: Foundation Complete
- [x] Created Phase 0 folder structure
- [x] Implemented AppShell + Layout components
- [x] Built Form System (12 field types)
- [x] Built DataTable System (8 components)
- [x] Created Contract domain components
- [x] Refactored initial pages (Portfolio, Commitments, Contracts)
- [x] Validated build success

**2025-12-10**: Testing Infrastructure
- [x] Mock authentication system
- [x] 11 Playwright test files
- [x] 40+ UI screenshots captured
- [x] 11 visual regression baselines
- [x] 8 E2E user journey tests
- [x] GitHub Actions CI/CD integration

**2025-12-15-16**: Enhancements
- [x] Folder structure consolidation
- [x] Type import centralization
- [x] Chat RAG offline mode
- [x] Docs explorer hardening
- [x] Generic table editing feature

---

## Validation Checklist

Phase 0 is complete when:

- [x] All core layout components exist and are documented
- [x] All table system components work with real data
- [x] All form components support validation
- [x] Domain components cover key workflows
- [x] At least 5 pages successfully refactored
- [x] Build passes with no TypeScript errors
- [x] Basic Playwright tests pass
- [x] Visual regression baselines captured

**Status**: ✅ Phase 0 Complete

---

## Core Layout Components

| Component | Description | Features | File | Status |
| --- | --- | --- | --- | --- |
| **AppShell** | Main application shell with sidebar, header, and content area | Responsive sidebar (collapsible on mobile), Fixed header with breadcrumbs, Main content area with proper spacing, Project context awareness | [app-shell.tsx](../../frontend/src/components/layout/app-shell.tsx) | ✅ |
| **PageHeader** | Standardized page header with title, description, and actions | Client name badge (optional), Page title and description, Action buttons (primary/secondary), Breadcrumb navigation, Tabs support | [PageHeader.tsx](../../frontend/src/components/layout/PageHeader.tsx) | ✅ |
| **PageContainer** | Consistent content wrapper with max-width and padding | Responsive padding, Max-width constraints (1800px default), Background color options, Vertical spacing | [PageContainer.tsx](../../frontend/src/components/layout/PageContainer.tsx) | ✅ |
| **PageTabs** | Tabbed navigation for multi-view pages | Active tab highlighting, Keyboard navigation, URL-based routing, Badge support for tab counts | [PageTabs.tsx](../../frontend/src/components/layout/PageTabs.tsx) | ✅ |
| **PageToolbar** | Action toolbar with search, filters, and buttons | Search input with debouncing, Filter dropdowns (status, category, etc.), Action buttons (create, export, etc.), Mobile responsive (drawer on small screens) | [PageToolbar.tsx](../../frontend/src/components/layout/PageToolbar.tsx) | ✅ |

---

## Table System

### DataTable (Core)
**File**: [frontend/src/components/tables/DataTable.tsx](../../frontend/src/components/tables/DataTable.tsx)

Powerful data table built on TanStack Table with sorting, filtering, and pagination.

**Features**:
- Column sorting (single and multi)
- Row selection (single and bulk)
- Column visibility toggle
- Responsive design
- Loading states
- Empty states
- Expandable rows

**Status**: ✅ Complete

### DataTableToolbar
**File**: [frontend/src/components/tables/DataTableToolbar.tsx](../../frontend/src/components/tables/DataTableToolbar.tsx)

Toolbar for table actions and filters.

**Features**:
- Global search
- Filter chips
- Column toggle
- Bulk actions (when rows selected)
- View mode toggle (grid/list)

**Status**: ✅ Complete

### DataTablePagination
**File**: [frontend/src/components/tables/DataTablePagination.tsx](../../frontend/src/components/tables/DataTablePagination.tsx)

Pagination controls with page size selector.

**Features**:
- Previous/next buttons
- Page number input
- Rows per page selector (10, 20, 50, 100)
- Total row count display

**Status**: ✅ Complete

### DataTableFilters
**File**: [frontend/src/components/tables/DataTableFilters.tsx](../../frontend/src/components/tables/DataTableFilters.tsx)

Advanced filtering UI for complex queries.

**Features**:
- Multiple filter types (select, date range, number range)
- Filter chip display
- Clear all filters
- Preset filter combinations

**Status**: ✅ Complete

### DataTableColumnToggle
**File**: [frontend/src/components/tables/DataTableColumnToggle.tsx](../../frontend/src/components/tables/DataTableColumnToggle.tsx)

Column visibility control dropdown.

**Status**: ✅ Complete

### DataTableBulkActions
**File**: [frontend/src/components/tables/DataTableBulkActions.tsx](../../frontend/src/components/tables/DataTableBulkActions.tsx)

Bulk action toolbar when rows are selected.

**Features**:
- Delete, export, update actions
- Selection count display
- Select all/none shortcuts

**Status**: ✅ Complete

### DataTableEmptyState
**File**: [frontend/src/components/tables/DataTableEmptyState.tsx](../../frontend/src/components/tables/DataTableEmptyState.tsx)

Empty state display for tables with no data.

**Features**:
- Icon, title, description
- Call-to-action button
- Different states (no data vs no search results)

**Status**: ✅ Complete

### DataTableSkeleton
**File**: [frontend/src/components/tables/DataTableSkeleton.tsx](../../frontend/src/components/tables/DataTableSkeleton.tsx)

Loading skeleton for tables.

**Status**: ✅ Complete

### Generic Table Factory
**File**: [frontend/src/components/tables/generic-table-factory.tsx](../../frontend/src/components/tables/generic-table-factory.tsx)

Factory function that creates complete table pages from configuration.

**Features**:
- Config-driven columns
- Automatic CRUD operations
- Inline editing with dialog
- Server-side sorting/filtering
- Export functionality

**Status**: ✅ Complete (2025-12-16 with editing support)

---

## Form System

### Form (Core)
**File**: [frontend/src/components/forms/Form.tsx](../../frontend/src/components/forms/Form.tsx)

Form wrapper with React Hook Form + Zod validation.

**Features**:
- Automatic validation
- Error display
- Submit handling
- Loading states
- Reset functionality

**Status**: ✅ Complete

### FormSection
**File**: [frontend/src/components/forms/FormSection.tsx](../../frontend/src/components/forms/FormSection.tsx)

Logical grouping of form fields with title and description.

**Status**: ✅ Complete

### FormField (Base)
**File**: [frontend/src/components/forms/FormField.tsx](../../frontend/src/components/forms/FormField.tsx)

Base field wrapper with label, error display, and help text.

**Status**: ✅ Complete

### Field Components

All field components follow consistent patterns:
- Label with optional/required indicator
- Help text support
- Error message display
- Disabled state styling
- Accessibility attributes

**Available Fields**:
- ✅ **TextField** - [frontend/src/components/forms/TextField.tsx](../../frontend/src/components/forms/TextField.tsx)
- ✅ **TextareaField** - [frontend/src/components/forms/TextareaField.tsx](../../frontend/src/components/forms/TextareaField.tsx)
- ✅ **SelectField** - [frontend/src/components/forms/SelectField.tsx](../../frontend/src/components/forms/SelectField.tsx)
- ✅ **MultiSelectField** - [frontend/src/components/forms/MultiSelectField.tsx](../../frontend/src/components/forms/MultiSelectField.tsx)
- ✅ **DateField** - [frontend/src/components/forms/DateField.tsx](../../frontend/src/components/forms/DateField.tsx)
- ✅ **MoneyField** - [frontend/src/components/forms/MoneyField.tsx](../../frontend/src/components/forms/MoneyField.tsx)
- ✅ **NumberField** - [frontend/src/components/forms/NumberField.tsx](../../frontend/src/components/forms/NumberField.tsx)
- ✅ **CheckboxField** - [frontend/src/components/forms/CheckboxField.tsx](../../frontend/src/components/forms/CheckboxField.tsx)
- ✅ **ToggleField** - [frontend/src/components/forms/ToggleField.tsx](../../frontend/src/components/forms/ToggleField.tsx)
- ✅ **RichTextField** - [frontend/src/components/forms/RichTextField.tsx](../../frontend/src/components/forms/RichTextField.tsx)
- ✅ **AutocompleteField** - [frontend/src/components/forms/AutocompleteField.tsx](../../frontend/src/components/forms/AutocompleteField.tsx)
- ✅ **FileUploadField** - [frontend/src/components/forms/FileUploadField.tsx](../../frontend/src/components/forms/FileUploadField.tsx)

---

## UI Elements

### Avatar
**File**: [frontend/src/components/ui/avatar.tsx](../../frontend/src/components/ui/avatar.tsx)

User avatar with fallback initials.

**Status**: ✅ Complete

### Badge
**File**: [frontend/src/components/ui/badge.tsx](../../frontend/src/components/ui/badge.tsx)

Status badges with color variants.

**Variants**:
- Default, secondary, destructive, outline
- Success, warning, info
- Custom colors

**Status**: ✅ Complete

### Button
**File**: [frontend/src/components/ui/button.tsx](../../frontend/src/components/ui/button.tsx)

Button component with multiple variants and sizes.

**Status**: ✅ Complete

### Dialog/Modal
**File**: [frontend/src/components/ui/dialog.tsx](../../frontend/src/components/ui/dialog.tsx)

Modal dialog with header, content, and footer.

**Status**: ✅ Complete

### Drawer
**File**: [frontend/src/components/ui/drawer.tsx](../../frontend/src/components/ui/drawer.tsx)

Side drawer for forms and details.

**Status**: ✅ Complete

### Sheet
**File**: [frontend/src/components/ui/sheet.tsx](../../frontend/src/components/ui/sheet.tsx)

Slide-out panel (similar to drawer).

**Status**: ✅ Complete

### Toast/Sonner
**File**: [frontend/src/components/ui/sonner.tsx](../../frontend/src/components/ui/sonner.tsx)

Toast notifications for success/error/info messages.

**Status**: ✅ Complete

### DropdownMenu
**File**: [frontend/src/components/ui/dropdown-menu.tsx](../../frontend/src/components/ui/dropdown-menu.tsx)

Action menu with keyboard navigation.

**Status**: ✅ Complete

---

## Domain Components

### Contract Forms
**Location**: [frontend/src/components/domain/contracts/](../../frontend/src/components/domain/contracts/)

Specialized components for contract creation and editing.

**Components**:
- ✅ ContractForm - Main form wrapper
- ✅ ContractGeneralSection - Basic contract info
- ✅ ContractBillingSection - Billing and retention
- ✅ ContractDatesSection - Start/end dates
- ✅ ContractPrivacySection - Access controls
- ✅ ScheduleOfValuesGrid - SOV line items
- ✅ CostCodeSelector - Cost code picker
- ✅ PurchaseOrderForm - PO creation

**Status**: ✅ Complete

---

## Design System Primitives

### StatCard
**File**: [frontend/src/components/design-system/stat-card.tsx](../../frontend/src/components/design-system/stat-card.tsx)

Metric card with icon, label, and value.

**Status**: ✅ Complete

### ContentCard
**File**: [frontend/src/components/design-system/content-card.tsx](../../frontend/src/components/design-system/content-card.tsx)

Generic content card with optional header/footer.

**Status**: ✅ Complete

### EmptyState
**File**: [frontend/src/components/design-system/empty-state.tsx](../../frontend/src/components/design-system/empty-state.tsx)

Empty state with icon, message, and CTA.

**Status**: ✅ Complete

### SectionHeader
**File**: [frontend/src/components/design-system/section-header.tsx](../../frontend/src/components/design-system/section-header.tsx)

Section title with optional description and actions.

**Status**: ✅ Complete

---

## Infinite Scroll Document Browser

**Purpose**: Recreate Supabase-style infinite scroll experience for browsing documents with animations and parallax effects.

**Features**:
- Scroll-triggered loading (no pagination buttons)
- Staggered card entrance animations
- Parallax background effects
- Filter-aware instant re-querying
- Accessibility fallbacks (prefers-reduced-motion)

**Key Files**:
- ✅ `frontend/src/hooks/use-infinite-query.ts` - Core infinite query hook
- ✅ `frontend/src/hooks/useInfiniteDocuments.ts` - Document-specific wrapper
- ✅ `frontend/src/components/documents/infinite/DocumentCard.tsx` - Animated card
- ✅ `frontend/src/components/documents/infinite/DocumentFilters.tsx` - Filter controls
- ✅ `frontend/src/components/documents/infinite/InfiniteSentinel.tsx` - Intersection observer
- ✅ `frontend/src/app/(demo)/documents-infinite/page.tsx` - Demo page

**Tests**:
- ✅ `frontend/tests/e2e/documents-infinite-scroll.spec.ts`
- ✅ `frontend/tests/screenshots/documents-infinite-scroll.png`

**Status**: ✅ Complete

---

## Completed Pages Using Phase 0 Components

### Financial Pages
- ✅ Budget
- ✅ Commitments (Subcontracts & POs)
- ✅ Contracts (Prime)
- ✅ Change Events
- ✅ Change Orders
- ✅ Billing Periods
- ✅ Invoices

### Project Management Pages
- ✅ Meetings
- ✅ Punch List
- ✅ RFIs
- ✅ Submittals
- ✅ Daily Log
- ✅ Photos
- ✅ Drawings
- ✅ Emails

### Directory Pages
- ✅ Company Directory
- ✅ Client Directory
- ✅ User Directory
- ✅ Tasks

### Documents
- ✅ Documents (infinite scroll)

---

## Usage Guidelines

### When Building New Pages

1. **Start with layout**:
   ```tsx
   <PageContainer>
     <PageHeader
       title="Page Title"
       description="Page description"
       actions={<Button>Create</Button>}
     />
     {/* content */}
   </PageContainer>
   ```

2. **Add tables**:
   ```tsx
   <DataTable
     columns={columns}
     data={data}
     onRowClick={handleRowClick}
   />
   ```

3. **Build forms**:
   ```tsx
   <Form onSubmit={handleSubmit} schema={mySchema}>
     <FormSection title="General">
       <TextField name="title" label="Title" />
       <SelectField name="status" label="Status" options={statusOptions} />
     </FormSection>
   </Form>
   ```

### Component Selection Guide

**For layout**: Use PageContainer, PageHeader, PageToolbar
**For lists**: Use DataTable or generic-table-factory
**For create/edit**: Use Form with domain components
**For metrics**: Use StatCard
**For empty states**: Use EmptyState
**For actions**: Use Button, DropdownMenu
**For feedback**: Use Toast (sonner)

---

## Future Enhancements

### Planned Components
- [ ] InfoTag - Information tooltip badges
- [ ] Pill - Small status indicators
- [ ] ToolbarButton - Specialized toolbar actions
- [ ] RLS permission tests - Row-level security validation

### Planned Features
- [ ] Change event impact analysis (AI)
- [ ] Invoice discrepancy detection (AI)
- [ ] Advanced data export formats
- [ ] Keyboard shortcut system

---

**Last Updated**: 2025-12-17
**Maintained By**: Alleato Engineering Team
